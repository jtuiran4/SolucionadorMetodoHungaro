<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solucionador M√©todo H√∫ngaro</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .content {
            padding: 30px;
        }

        .input-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
        }

        .matrix-container {
            margin: 20px 0;
        }

        .matrix-input {
            display: grid;
            gap: 10px;
            max-width: fit-content;
            margin: 0 auto;
        }

        .matrix-input input {
            width: 80px;
            text-align: center;
            font-weight: 600;
        }

        button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            margin: 10px 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .solve-btn {
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .solve-btn:hover {
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .results {
            margin-top: 30px;
        }

        .step {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #2196F3;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step h3 {
            color: #2196F3;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #e3f2fd;
            padding-bottom: 10px;
        }

        .matrix-display {
            overflow-x: auto;
            margin: 15px 0;
        }

        table {
            border-collapse: collapse;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid #ddd;
            font-weight: 600;
        }

        th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 1.1em;
        }

        .highlighted {
            background-color: #ffeb3b !important;
            color: #333;
            font-weight: bold;
        }

        .assigned {
            background-color: #4caf50 !important;
            color: white;
            font-weight: bold;
        }

        .crossed {
            background-color: #f44336 !important;
            color: white;
            text-decoration: line-through;
        }

        .cost-summary {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .example-buttons {
            text-align: center;
            margin: 20px 0;
        }

        .example-btn {
            background: linear-gradient(135deg, #9C27B0, #E1BEE7);
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.3);
        }

        .example-btn:hover {
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.4);
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 5px solid #f44336;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 15px;
            }
            
            .matrix-input input {
                width: 60px;
            }
            
            th, td {
                padding: 8px 10px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Solucionador M√©todo H√∫ngaro</h1>
            <p>Resuelve problemas de asignaci√≥n paso a paso</p>
        </div>
        
        <div class="content">
            <div class="input-section">
                <div class="input-group">
                    <label for="problemType">Tipo de Problema:</label>
                    <select id="problemType">
                        <option value="minimization">Minimizaci√≥n</option>
                        <option value="maximization">Maximizaci√≥n</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="matrixSize">Tama√±o de la Matriz:</label>
                    <input type="number" id="matrixSize" min="2" max="6" value="3">
                    <button onclick="createMatrix()">Crear Matriz</button>
                </div>
                
                <div class="example-buttons">
                    <button class="example-btn" onclick="loadExample(1)">Ejemplo 1 (3x3)</button>
                    <button class="example-btn" onclick="loadExample(2)">Ejemplo 2 (4x4)</button>
                </div>
                
                <div id="matrixContainer"></div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="solve-btn" onclick="solve()">üöÄ Resolver</button>
                </div>
            </div>
            
            <div id="results"></div>
        </div>
    </div>

    <script>
        let matrix = [];
        let steps = [];

        function createMatrix() {
            const size = parseInt(document.getElementById('matrixSize').value);
            const container = document.getElementById('matrixContainer');
            
            container.innerHTML = `
                <div class="matrix-container">
                    <h3>Matriz de Costos:</h3>
                    <div class="matrix-input" id="matrixInput"></div>
                </div>
            `;
            
            const matrixInput = document.getElementById('matrixInput');
            matrixInput.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.id = `cell_${i}_${j}`;
                    input.placeholder = '0';
                    input.value = '0';
                    matrixInput.appendChild(input);
                }
            }
        }

        function loadExample(exampleNum) {
            if (exampleNum === 1) {
                document.getElementById('matrixSize').value = 3;
                createMatrix();
                const example1 = [[4, 2, 8], [4, 3, 7], [1, 2, 5]];
                loadMatrixValues(example1);
            } else if (exampleNum === 2) {
                document.getElementById('matrixSize').value = 4;
                createMatrix();
                const example2 = [[10, 2, 8, 6], [9, 4, 7, 8], [7, 6, 5, 2], [8, 1, 4, 9]];
                loadMatrixValues(example2);
            }
        }

        function loadMatrixValues(values) {
            for (let i = 0; i < values.length; i++) {
                for (let j = 0; j < values[i].length; j++) {
                    document.getElementById(`cell_${i}_${j}`).value = values[i][j];
                }
            }
        }

        function getMatrix() {
            const size = parseInt(document.getElementById('matrixSize').value);
            const matrix = [];
            
            for (let i = 0; i < size; i++) {
                matrix[i] = [];
                for (let j = 0; j < size; j++) {
                    const value = parseFloat(document.getElementById(`cell_${i}_${j}`).value) || 0;
                    matrix[i][j] = value;
                }
            }
            
            return matrix;
        }

        function solve() {
            try {
                matrix = getMatrix();
                const problemType = document.getElementById('problemType').value;
                
                steps = [];
                
                // Para maximizaci√≥n, convertir a minimizaci√≥n
                let workingMatrix = matrix.map(row => [...row]);
                if (problemType === 'maximization') {
                    const maxValue = Math.max(...matrix.flat());
                    workingMatrix = matrix.map(row => row.map(val => maxValue - val));
                    
                    steps.push({
                        title: "Paso 0: Conversi√≥n para Maximizaci√≥n",
                        description: `Convertimos el problema de maximizaci√≥n a minimizaci√≥n restando cada elemento del valor m√°ximo (${maxValue}).`,
                        matrix: workingMatrix,
                        type: 'conversion'
                    });
                }
                
                // Paso 1: Restar el m√≠nimo de cada fila
                const step1Matrix = subtractRowMinimums(workingMatrix);
                
                // Paso 2: Restar el m√≠nimo de cada columna
                const step2Matrix = subtractColumnMinimums(step1Matrix);
                
                // Paso 3: Encontrar asignaci√≥n √≥ptima
                const solution = findOptimalAssignment(step2Matrix);
                
                displayResults(solution, problemType);
                
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }

        function subtractRowMinimums(matrix) {
            const newMatrix = matrix.map(row => [...row]);
            const size = matrix.length;
            
            for (let i = 0; i < size; i++) {
                const rowMin = Math.min(...matrix[i]);
                for (let j = 0; j < size; j++) {
                    newMatrix[i][j] = matrix[i][j] - rowMin;
                }
            }
            
            steps.push({
                title: "Paso 1: Reducci√≥n por Filas",
                description: "Restamos el elemento m√≠nimo de cada fila a todos los elementos de esa fila.",
                matrix: newMatrix,
                type: 'row_reduction'
            });
            
            return newMatrix;
        }

        function subtractColumnMinimums(matrix) {
            const newMatrix = matrix.map(row => [...row]);
            const size = matrix.length;
            
            for (let j = 0; j < size; j++) {
                const colMin = Math.min(...matrix.map(row => row[j]));
                for (let i = 0; i < size; i++) {
                    newMatrix[i][j] = matrix[i][j] - colMin;
                }
            }
            
            steps.push({
                title: "Paso 2: Reducci√≥n por Columnas",
                description: "Restamos el elemento m√≠nimo de cada columna a todos los elementos de esa columna.",
                matrix: newMatrix,
                type: 'column_reduction'
            });
            
            return newMatrix;
        }

        function findOptimalAssignment(matrix) {
            const size = matrix.length;
            let assignment = new Array(size).fill(-1);
            let covered = false;
            let iteration = 0;
            
            while (!covered && iteration < 10) {
                iteration++;
                
                // Intentar cubrir todos los ceros con el m√≠nimo n√∫mero de l√≠neas
                const coverage = findMinimumCoverage(matrix);
                
                steps.push({
                    title: `Paso ${2 + iteration}: Verificaci√≥n de Cobertura`,
                    description: `Intentamos cubrir todos los ceros con el m√≠nimo n√∫mero de l√≠neas. Necesitamos ${size} l√≠neas para una soluci√≥n √≥ptima.`,
                    matrix: matrix,
                    coverage: coverage,
                    type: 'coverage_check'
                });
                
                if (coverage.lines.length === size) {
                    // Encontrar asignaci√≥n
                    assignment = findAssignment(matrix);
                    covered = true;
                } else {
                    // Aplicar el paso de mejora
                    matrix = improveMatrix(matrix, coverage);
                    
                    steps.push({
                        title: `Paso ${2 + iteration}b: Mejora de la Matriz`,
                        description: "Como no podemos cubrir todos los ceros con el n√∫mero m√≠nimo de l√≠neas, aplicamos el m√©todo de mejora.",
                        matrix: matrix,
                        type: 'improvement'
                    });
                }
            }
            
            const totalCost = calculateTotalCost(assignment);
            
            return {
                assignment: assignment,
                totalCost: totalCost,
                finalMatrix: matrix
            };
        }

        function findMinimumCoverage(matrix) {
            const size = matrix.length;
            const zeros = [];
            
            // Encontrar todas las posiciones de ceros
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    if (matrix[i][j] === 0) {
                        zeros.push([i, j]);
                    }
                }
            }
            
            // Algoritmo simple de cobertura (puede mejorarse)
            const coveredRows = new Set();
            const coveredCols = new Set();
            const lines = [];
            
            // Priorizar filas con m√°s ceros
            const rowZeroCounts = new Array(size).fill(0);
            const colZeroCounts = new Array(size).fill(0);
            
            for (const [i, j] of zeros) {
                rowZeroCounts[i]++;
                colZeroCounts[j]++;
            }
            
            // Cubrir filas con m√°s ceros primero
            const sortedRows = Array.from({length: size}, (_, i) => i)
                .sort((a, b) => rowZeroCounts[b] - rowZeroCounts[a]);
            
            for (const row of sortedRows) {
                if (rowZeroCounts[row] > 0 && !coveredRows.has(row)) {
                    let shouldCoverRow = false;
                    for (let col = 0; col < size; col++) {
                        if (matrix[row][col] === 0 && !coveredCols.has(col)) {
                            shouldCoverRow = true;
                            break;
                        }
                    }
                    if (shouldCoverRow) {
                        coveredRows.add(row);
                        lines.push({type: 'row', index: row});
                    }
                }
            }
            
            // Cubrir columnas restantes
            for (let col = 0; col < size; col++) {
                if (!coveredCols.has(col)) {
                    let hasUncoveredZero = false;
                    for (let row = 0; row < size; row++) {
                        if (matrix[row][col] === 0 && !coveredRows.has(row)) {
                            hasUncoveredZero = true;
                            break;
                        }
                    }
                    if (hasUncoveredZero) {
                        coveredCols.add(col);
                        lines.push({type: 'col', index: col});
                    }
                }
            }
            
            return {
                lines: lines,
                coveredRows: Array.from(coveredRows),
                coveredCols: Array.from(coveredCols)
            };
        }

        function improveMatrix(matrix, coverage) {
            const size = matrix.length;
            const newMatrix = matrix.map(row => [...row]);
            
            // Encontrar el m√≠nimo elemento no cubierto
            let minUncovered = Infinity;
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    if (!coverage.coveredRows.includes(i) && !coverage.coveredCols.includes(j)) {
                        minUncovered = Math.min(minUncovered, matrix[i][j]);
                    }
                }
            }
            
            // Aplicar transformaci√≥n
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    if (!coverage.coveredRows.includes(i) && !coverage.coveredCols.includes(j)) {
                        // Elemento no cubierto: restar el m√≠nimo
                        newMatrix[i][j] = matrix[i][j] - minUncovered;
                    } else if (coverage.coveredRows.includes(i) && coverage.coveredCols.includes(j)) {
                        // Elemento doblemente cubierto: sumar el m√≠nimo
                        newMatrix[i][j] = matrix[i][j] + minUncovered;
                    }
                    // Elementos cubiertos una vez: no cambian
                }
            }
            
            return newMatrix;
        }

        function findAssignment(matrix) {
            const size = matrix.length;
            const assignment = new Array(size).fill(-1);
            const usedCols = new Set();
            
            // Algoritmo greedy para encontrar asignaci√≥n
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    if (matrix[i][j] === 0 && !usedCols.has(j)) {
                        assignment[i] = j;
                        usedCols.add(j);
                        break;
                    }
                }
            }
            
            return assignment;
        }

        function calculateTotalCost(assignment) {
            let total = 0;
            for (let i = 0; i < assignment.length; i++) {
                if (assignment[i] !== -1) {
                    total += matrix[i][assignment[i]];
                }
            }
            return total;
        }

        function displayResults(solution, problemType) {
            const resultsDiv = document.getElementById('results');
            let html = '<div class="results">';
            
            // Mostrar todos los pasos
            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                html += `
                    <div class="step">
                        <h3>${step.title}</h3>
                        <p>${step.description}</p>
                        <div class="matrix-display">
                            ${createTableHTML(step.matrix, step.type, step.coverage)}
                        </div>
                    </div>
                `;
            }
            
            // Mostrar soluci√≥n final
            html += `
                <div class="step">
                    <h3>Soluci√≥n √ìptima</h3>
                    <p>Asignaci√≥n encontrada:</p>
                    <div class="matrix-display">
                        ${createSolutionTableHTML(solution.assignment)}
                    </div>
                </div>
                
                <div class="cost-summary">
                    <div>üí∞ Costo Total ${problemType === 'maximization' ? '(Beneficio)' : ''}: ${solution.totalCost}</div>
                </div>
            `;
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }

        function createTableHTML(matrix, type = '', coverage = null) {
            const size = matrix.length;
            let html = '<table>';
            
            // Encabezados
            html += '<tr><th></th>';
            for (let j = 0; j < size; j++) {
                html += `<th>C${j + 1}</th>`;
            }
            html += '</tr>';
            
            // Filas de datos
            for (let i = 0; i < size; i++) {
                html += `<tr><th>F${i + 1}</th>`;
                for (let j = 0; j < size; j++) {
                    let cellClass = '';
                    
                    if (type === 'coverage_check' && coverage) {
                        if (coverage.coveredRows.includes(i) || coverage.coveredCols.includes(j)) {
                            cellClass = 'crossed';
                        }
                    }
                    
                    if (matrix[i][j] === 0) {
                        cellClass += ' highlighted';
                    }
                    
                    html += `<td class="${cellClass}">${matrix[i][j]}</td>`;
                }
                html += '</tr>';
            }
            
            html += '</table>';
            return html;
        }

        function createSolutionTableHTML(assignment) {
            const size = assignment.length;
            let html = '<table>';
            
            // Encabezados
            html += '<tr><th></th>';
            for (let j = 0; j < size; j++) {
                html += `<th>C${j + 1}</th>`;
            }
            html += '</tr>';
            
            // Filas de datos
            for (let i = 0; i < size; i++) {
                html += `<tr><th>F${i + 1}</th>`;
                for (let j = 0; j < size; j++) {
                    let cellClass = '';
                    let cellValue = matrix[i][j];
                    
                    if (assignment[i] === j) {
                        cellClass = 'assigned';
                        cellValue += ' ‚úì';
                    }
                    
                    html += `<td class="${cellClass}">${cellValue}</td>`;
                }
                html += '</tr>';
            }
            
            html += '</table>';
            
            // Agregar descripci√≥n de la asignaci√≥n
            html += '<div style="margin-top: 15px;"><strong>Asignaci√≥n:</strong><br>';
            for (let i = 0; i < assignment.length; i++) {
                if (assignment[i] !== -1) {
                    html += `Fila ${i + 1} ‚Üí Columna ${assignment[i] + 1} (Costo: ${matrix[i][assignment[i]]})<br>`;
                }
            }
            html += '</div>';
            
            return html;
        }

        // Inicializar con matriz 3x3
        window.onload = function() {
            createMatrix();
        };
    </script>
</body>
</html>